# Как сохранять комплекс заметок

Когда была одна заметка, сохраняем по ключу-константе. Никаких созданий и удалений. Ключ, например `note`. Это "первый уровень".

1. Теперь, когда у нас несколько заметок, как сохранять?
2. Как перейти программно от хранения одной заметки (первый уровень) к нескольким?

Думаем два варианта:

1. Сохранение в виде нескольких файлов
2. Сохранение в один файл

## 1. Сохранение в виде нескольких файлов

Всё равно будут заранее определённые ключи-константы. Либо явные, как исходная заметка под ключом `note`, либо подразумеваемые, как "получить список всех заметок", как я делал в таймере и первой версии сервиса заметок. "Список всех заметок", получаемый по конкретному специфическому запросу - есть "вход", а конкретный запрос - ключ-константа.

## 2. Сохранение в один файл

- Разделение YAML на документы внутри.
- Должна быть в любом случае точка "входа". Аналогия - загрузочный сектор HDD, операционной системы. "Что там у нас?".

**Точкой входа** может быть та самая исходная заметка под ключом-константой, `note`. Только теперь она исполняет роль описания что происходит в сервисе. Правда получается это для сохранения в виде нескольких файлов. А для сохранения в виде одного файла - точкой входа может быть просто первый документ.

## 3. Точка входа

Точка входа - есть способ хранения информации о комплексе заметок? В некотором смысле URL уже есть ключ-константа, по которому мы получим всю необходимую информацию. Доступ таким образом имеет (всегда ли?) две стороны - переменную (разные данные, разное содержание) и постоянную - конкретная уникальная ссылка на хранилище, конкретная уникальная ссылка на конкретную заметку.

В свою очередь эти уникальные ссылки могут одновременно являться переменными в рамках охватывающего их иного целого. Скажем некоторый список заметок, назовём его "по работе", имеет ключ-константу "по-работе". Однако внутри него может быть список переменного количества переменных ссылок на заметки.

Впрочем мне в любом случае нравится идея что заметка есть описание других заметок - с этого же я начинал.

Ну, предположим. Заметка-комплекс "По-работе", имеет содержание в виде списка ссылок на заметки. Его ключ "по-работе" записан в его конфиге. При этом эта заметка-комплекс так же имеет уникальный id, записанный в конфиг, по которому её можно найти.

Теоретически, я могу в виде заметок хранить и настройки меню сервиса. Звучит бомбически. Тогда боковое меню со списком проектов будет чем-то скажем с ключом-константой "боковоее меню со списком проектов". Но эту заметку ещё нужно найти... Кто будет её искать? Теоретически, если я как фронтенд-клиент, знаю и ожидаю её иметь, я именно её и буду искать. Таким образом, программировать надо связку:

а) Клиентское представление (меню, стол, список с текущим)
б) Серверное хранение, ключи-константы.

Это можно формализовать как плагины. Похожее на то что было в таймере. Плагин это модуль и к клиенту и к серверу (или лишь к клиенту). Плагин знает что искать, знает как сохранять.

Нужны ли id таким ссылкам? Если комплексы могут быть переменными значениями содержания других комплексов, то да. Скажем список проектов. Это список ссылок на другие комлексы ссылок.

## Точка входа - спорность

А нужна ли точка входа? Я имеею в виду, если у нас есть боковое меню, то оно само попытается достать свои свойства из хранилища. Если у нас есть представления со списком заметок и текущей заметкой, то оно само знает куда лезть за этим.

С другой стороны, если боковое меню неактивно - кто об этом узнает? Сначала все плагины грузятся а затем сами решают включаться или нет, или же всё-таки есть сначала глобальное пользовательское описание что грузить а что нет. И оно-то грузится по константе-ключу. И это точка входа. Вообще говоря это логично.

Точка входа может ссылаться на точки входа, являющиеся потомками. Это просто подробности взаимоотношений точек входа...

Просто получается что точки входа, ссылки, являются чем-то отдельным, различным от обычных заметок. Их хочется как-то от них отделить. Но при этом они всё так же являются заметками и можно их хранить наряду с обычными... А где же точки входа? Хранить ли глобальные? Скажем неужели нужно все точки входа пихать в исходный `note`? Он распухнет. Скажем настройки приложения - можно ли просто хранить в файле `settings`? Выглядит крайне логично. Кстати! При этом, содержание файла `settings` может быть просто ссылкой на заметку, описывающую эти самые настройки (settings). То есть точки входа выносятся за пределы набора заметок, в корень хранилища, но реально они хранят лишь ссылки на заметки, которые уже располагаются внутри набора заметок.

Что ещё?

Ещё мне не нравится загромождение корня хранилища. Будет папка `content/` и куча файлов - точек входа. Хочется эти ссылки (точки входа) тоже сгруппировать, разместить в группе...

Может все эти ссылки пихнуть в заметку исходную `notes`? Или в папку `/config/`?

А может ли обычная заметка содержать точки входа? Где? Может, в содержании.

Будто ключи-константы, как только появляется папка `/content/`, куда-то должны потесниться. Куда? Что они есть такое, в рамках нового комплекса заметок, когда большее нет заметки, но есть комплекс заметок, который одновременно является и заметкой. И это возможно за счет этих самых ссылок.

...

Если возможна заметка, описывающая комплекс других заметок, внутри своего содержания, имеющая при этом и конфиг с id, то почему же глобальная заметка приложения, являющаяся точкой входа приложения, не может быть описанием комплекса всех заметок данного хранилища? Может. Это логично.

Наверное вопрос стоит по-другому: будет ли необходимость выводить какие-то ссылки в глобальную область видимости? Хм, но ведь эта точка входа (заметка), и есть глобальная область видимости. Всё что там находится - и есть доступно при загрузке. Даже более того, она удобна тем, что считывается один раз с диска и мы имеем всю раскладку. Аналогия этой заметки - регистр Windows или загрузочный сектор. Достаточно удобно получить его сразу весь, и уже решать что есть что и что делать дальше.

Да, пожалуй, можно использовать этот исходный `notes` как глобальный начальный регистр. Располагается он в его разделе 'content'.

Вопросы:

1. Язык описания комплексов заметок (как описать в исходном `notes`)?
2. Как перейти от исходной заметки как заметки к заметке как описанию комплекса заметок?

Нужно по-иному понимать то, что я вижу перед собой. Или точно также, просто в новой заметке как описанию комплекса будут ключевые слова.

Теоретически, как я сказал, мы имеем связку клиент-сервер в виде модуля, который знает как себя сохранять в точке входа, что искать и как показывать.

Поэтому язык описания комплекса заметок должен включать способ идентифицировать этот модуль, например:

```minota:current
current: 898fdf9sd8f-ds9fs9f98f9-df8s9df89sdf-dsf89sd89fsd
```

Откуда мы узнаем что 'current' есть имя модуля, ответственного за следующий блок описания. А чтобы отделить это от обычного кода, добавляем префикс `minota:`.

Еще хорошо, что Markdown собственно, и имеет синтаксис для различных языков - вот эти три тильды и далее название языка. Так что мы прямо по гайдам способны встраивать по сути "язык Minota" в текст заметок.

Например:

```minota
describe module {
  current: 'dfsdf-dfsdf-sdfsdf-dfsdfs'
}
```

или

```minota
current: 'fdfsdf=sdfsdfs=sdfsdfsd=dsdfsf'
```

## 4. Создание заметки

Создание заметки происходит в рамках выбранного модуля. Проблема еще в том, что создавая заметку в рамках просто списка с текущим, мы должны бы ещё проделать какие-то операции и с другими модулями. Они будто должно слушать акт создания заметки, чтобы проделать свои нужны операции, даже если они неактивны сейчас.

Впрочем, возможно это я забегаю вперед.

Почему возник этот вопрос, потому что стало ясно что переход от единой заметки к комплексу заметки, связан с актом создания впервые второй заметки.

Либо с самого начала первая заметка будет иметь дополнительные возможности, и ссылки внизу себя на модули... Или они появятся после создания новой заметки?

Весь вопрос как я создаю новую заметку. А ответ - это новый вопрос - а в рамках какого модуля я создаю заметку? В рамках этого модуля и будет определен UI акта создания. И скорей всего и UI размещения ссылок на комплекс заметок.

Таким образом "Модуль" это:

- Как хранить
- Как отображать
- Как описывать себя в исходной заметке-точке входа
- Как создаётся заметка, как удаляется, как изменяются. Или абстрактней - что позволяет модуль делать. Будут другие модули, позволяющие делить заметку на части или объединять их.

Глобальный вопрос далее - вложенность модулей? Теоретически да.

## Модуль

- Хранение (а). Описание себя в исходной заметке-точке входа.
- Отображение (б). Как просматривать заметки, как выполнять действия.
- Возможные акты пользователя (в). Например создание и удаление. Ещё доступ и просмотр, но это ближе к отображению.
